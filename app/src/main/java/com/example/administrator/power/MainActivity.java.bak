package com.example.administrator.power;

import android.support.v7.app.AppCompatActivity;
import android.os.Bundle;
import android.view.View;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;
import android.content.SharedPreferences;
import android.util.Log;

import android.widget.CompoundButton;
import android.widget.CompoundButton.OnCheckedChangeListener;
import android.widget.ToggleButton;
import android.widget.ImageView;


import com.rscja.deviceapi.CardWithBYL;
import com.rscja.deviceapi.ScanerLedLight;
import com.rscja.deviceapi.exception.ConfigurationException;


public class MainActivity extends AppCompatActivity {

    Button gpio_H;//
    private ToggleButton toggleButton;
    private ImageView imageView;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        gpio_H=(Button)findViewById(R.id.gpio67_H);
		toggleButton=(ToggleButton)findViewById(R.id.tb);
        
        /*
		 *init
		 */
		//public void init() {
			SharedPreferences pref = getSharedPreferences("data", MODE_PRIVATE);
			boolean powerState = pref.getBoolean("power", false);
			
			if(powerState){
				toggleButton.setChecked(false);
				Toast.makeText(MainActivity.this, "true", Toast.LENGTH_SHORT).show();
			}else{
				toggleButton.setChecked(true);
				Toast.makeText(MainActivity.this, "false", Toast.LENGTH_SHORT).show();
			}
		//}
        //init();
        gpio_H.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View view) {
                try {
                    com.rscja.deviceapi.Module.getInstance().powerOn(2);
                    Toast.makeText(MainActivity.this, "high", Toast.LENGTH_SHORT).show();
                } catch (ConfigurationException e) {
                    e.printStackTrace();
                }
            }
        });

     
       // imageView=(ImageView)findViewById(R.id.iv);
        toggleButton.setOnCheckedChangeListener(new CompoundButton.OnCheckedChangeListener() {
            @Override
            public void onCheckedChanged(CompoundButton buttonView, boolean isChecked) {
				try {
					if(isChecked){
						SharedPreferences.Editor editor = getSharedPreferences("data", MODE_PRIVATE).edit();
						editor.putBoolean("power", false);
						editor.apply();
						com.rscja.deviceapi.Module.getInstance().powerOff(2);
						Toast.makeText(MainActivity.this, "low", Toast.LENGTH_SHORT).show();
						 Log.d("MainActivity", "powerOn");
					}else{
						SharedPreferences.Editor editor = getSharedPreferences("data", MODE_PRIVATE).edit();
						editor.putBoolean("power", true);
						editor.apply();
						com.rscja.deviceapi.Module.getInstance().powerOn(2);
						Toast.makeText(MainActivity.this, "high", Toast.LENGTH_SHORT).show();
						Log.d("MainActivity", "powerOff");
					}
				} catch (ConfigurationException e) {
					e.printStackTrace();
				}
           //     imageView.setImageResource(isChecked?R.drawable.on:R.drawable.off);
            }
        });

    }
}